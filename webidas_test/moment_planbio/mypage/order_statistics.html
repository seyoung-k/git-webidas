{*** 마이페이지 > 주문현황 | mypage/order_statistics.php ***}
{ # header }

<div class="content">
    <div class="mypage_cont">

        <div class="mypage_lately_info">
            <div class="mypage_zone_tit">
                <h3>{=__('주문통계')}</h3>
            </div>

            <div class="mypage_table_type statistics_table">
                <table>
                    <colgroup>
                        <col style="width:10%"/>
                        <col style="width:6%"/>
                        <col style="width:6%"/>
                        <col style="width:6%"/>
                        <col style="width:6%"/>
                        <col style="width:6%"/>
                        <col style="width:6%"/>
                        <col style="width:6%"/>
                        <col style="width:6%"/>
                        <col style="width:6%"/>
                        <col style="width:6%"/>
                        <col style="width:6%"/>
                        <col style="width:6%"/>
                        <col style="width:6%"/>
                        <col style="width:6%"/>
                    </colgroup>
                    <thead>
                        <tr>
                            <th>구분</th>
                            <th>1월</th>
                            <th>2월</th>
                            <th>3월</th>
                            <th>4월</th>
                            <th>5월</th>
                            <th>6월</th>
                            <th>7월</th>
                            <th>8월</th>
                            <th>9월</th>
                            <th>10월</th>
                            <th>11월</th>
                            <th>12월</th>
                            <th>합계</th>
                            <th>평균</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>시장 평균가</td>
                            <!--{ ? yearData }-->
                            <!--{ @ yearData }-->
                            <td>
                                {=gd_global_money_format(.totalFixedPrice)}{=gd_global_currency_string()}
                            </td>
                            <!--{ / }-->
                            <!--{ / }-->
                        </tr>
                        <tr>
                            <td>플랜닥스 구매가</td>
                            <!--{ ? yearData }-->
                            <!--{ @ yearData }-->
                            <td>
                                {=gd_global_money_format(.totalGoodsPrice)}{=gd_global_currency_string()}
                            </td>
                            <!--{ / }-->
                            <!--{ / }-->
                        </tr>
                        <tr>
                            <td>할인율(시장대비 절검율)</td>
                            <!--{ ? yearData }-->
                            <!--{ @ yearData }-->
                            <td>
                                <!--{ ? .totalFixedPrice - .totalGoodsPrice == 0 }-->
                                0 %
                                <!--{ : }-->
                                {=round(((.totalFixedPrice - .totalGoodsPrice)/.totalFixedPrice)*100, 1)} %
                                <!--{ / }-->
                            </td>
                            <!--{ / }-->
                            <!--{ / }-->
                        </tr>
                        <tr>
                            <td>주문건수</td>
                            <!--{ ? yearData }-->
                            <!--{ @ yearData }-->
                            <td>
                                <!--{ ? .key_ == "average" }-->
                                {=.orderNoCnt} 건
                                <!--{ : }-->
                                {=count(.orderNoList)} 건
                                <!--{ / }-->
                            </td>
                            <!--{ / }-->
                            <!--{ / }-->
                        </tr>
                        <tr>
                            <td>주문상품수</td>
                            <!--{ ? yearData }-->
                            <!--{ @ yearData }-->
                            <td>
                                <!--{ ? .key_ == "average" }-->
                                {=.orderGoodsNoCnt} 건
                                <!--{ : }-->
                                {=count(.orderGoodsNoList)} 건
                                <!--{ / }-->
                            </td>
                            <!--{ / }-->
                            <!--{ / }-->
                        </tr>
                    </tbody>
                </table>
                <hr class="margin_top_bottom">
                
                <form id="searchMonthFrm" name="searchMonthFrm" method="get">
                    <div class="date_check_calendar search_month_wrap">
                        <strong>월 검색</strong>
                        <input type="text" id="picker2" name="searchMonth" class="anniversary js_datepicker-months" value="{=searchMonth}" autocomplete="off"/>
                    </div>
                    <button type="submit" class="search_month_btn btn_date_check">조회</button>
                </form>
                <table class="search_month_table">
                    <colgroup>
                        <col style="width:20%;">
                        <col style="width:20%;">
                        <col style="width:20%;">
                        <col style="width:20%;">
                        <col style="width:20%;">
                    </colgroup>
                    <thead>
                        <tr>
                            <th>구분</th>
                            <th>전월</th>
                            <th>당월</th>
                            <th>차이</th>
                            <th>당월 평균</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>시장 평균가</td>
                            <!--{ ? monthData }-->
                            <!--{ @ monthData }-->
                            <td>
                                <!--{ ? .totalFixedPrice > 0 }-->
                                {=gd_global_money_format(.totalFixedPrice)} 
                                <!--{ : }-->
                                -
                                <!--{ / }-->
                            </td>
                            <!--{ / }-->
                            <!--{ / }-->
                        </tr>
                        <tr>
                            <td>플랜닥스 구매가</td>
                            <!--{ ? monthData }-->
                            <!--{ @ monthData }-->
                            <td>
                                <!--{ ? .totalGoodsPrice > 0 }-->
                                {=gd_global_money_format(.totalGoodsPrice)}
                                <!--{ : }-->
                                -
                                <!--{ / }-->
                            </td>
                            <!--{ / }-->
                            <!--{ / }-->
                        </tr>
                        <tr>
                            <td>할인율(시장대비 절검율)</td>
                            <!--{ ? monthData }-->
                            <!--{ @ monthData }-->
                            <td>
                                <!--{ ? .discount > 0 }-->
                                {=.discount} %
                                <!--{ : }-->
                                -
                                <!--{ / }-->
                            </td>
                            <!--{ / }-->
                            <!--{ / }-->
                        </tr>
                        <tr>
                            <td>주문건수</td>
                            <!--{ ? monthData }-->
                            <!--{ @ monthData }-->
                            <td>
                                <!--{ ? .totalOrderCnt > 0 }-->
                                {=.totalOrderCnt}
                                <!--{ : }-->
                                -
                                <!--{ / }-->
                            </td>
                            <!--{ / }-->
                            <!--{ / }-->
                        </tr>
                        <tr>
                            <td>주문상품수</td>
                            <!--{ ? monthData }-->
                            <!--{ @ monthData }-->
                            <td>
                                <!--{ ? .totalOrderGoodsCnt > 0 }-->
                                {=.totalOrderGoodsCnt}
                                <!--{ : }-->
                                -
                                <!--{ / }-->
                            </td>
                            <!--{ / }-->
                            <!--{ / }-->
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- //mypage_lately_info_cont -->
        </div>
        <!-- //mypage_lately_info -->
    </div>
</div>
<!-- //content -->

<script type="text/javascript">
    $(document).ready(function() {
        // 월별 인풋박스 선택 이벤트
        if ($('.js_datepicker-months').length) {
            var today = new Date();
            var minDate = new Date();
            
            // 이전 달부터 선택 가능
//            today.setMonth(today.getMonth() - 1);
//            today = new Date(today.getFullYear(), today.getMonth(), today.getDate());
            
            minDate.setDate(today.getDate() - 365);
            minDate = new Date(minDate.getFullYear(), minDate.getMonth(), minDate.getDate());

            $('.js_datepicker-months').datetimepicker({
                locale: '{=gGlobal.locale}',
                format: 'YYYY-MM',
                dayViewHeaderFormat: 'YYYY MM',
                viewMode: 'days',
                ignoreReadonly: true,
                debug: false,
                keepOpen: false,
                maxDate: today,
                minDate: minDate
            });
        }
        
        $("form[name='searchMonthFrm']").submit(function() {
            date = $("input[name='searchMonth']").val();
            searchYear = date.split("-")[0];
            searchMonth = date.split("-")[1];
            
            now = new Date();
            nowYear = now.getFullYear();
            nowMonth = ("0" + (now.getMonth()+1)).slice(-2);
            
            if (searchYear == nowYear && searchMonth == nowMonth) {
                alert("현재 월은 선택할 수 없습니다.");
                return false;
            }
        });
    });
</script>

{ # footer }